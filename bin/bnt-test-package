#!/usr/bin/env ruby 

require 'bnt/env'

package_path       = ARGV[0] 
package_name       = package_path.split("/").last
package_cage_path  = "#{Cage.packages_path}/#{package_name}"

release_path       = package_path.split("/")
release_path.pop
release_path.pop
release_path = release_path.join("/")

Runner.exec "mkdir -p #{Cage.package_path(package_name)}" 
Runner.exec "mount --bind #{package_path} #{Cage.package_path(package_name)}"

Runner.exec "mkdir -p #{Cage.package_path(package_name)}/#{package_name}"
Runner.exec "mount --bind #{release_path}/src/#{package_name} #{Cage.package_path(package_name)}/#{package_name}"
 
Runner.exec "chroot #{Cage.path} sh /var/vcap/btt/make-package #{package_name} "


